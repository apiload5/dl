# Install required packages - Fixed
packages:
  yum:
    git: []
    wget: []
    python3: []
    python3-pip: []
    epel-release: []

commands:
  01_update_system:
    command: |
      # Update system packages
      yum update -y
    ignoreErrors: true
    
  02_install_yt_dlp:
    command: |
      # Install yt-dlp globally
      python3 -m pip install --upgrade pip
      python3 -m pip install --upgrade yt-dlp
      
      # Create symlink for easy access
      ln -sf /usr/local/bin/yt-dlp /usr/bin/yt-dlp || true
      
      # Verify installation
      yt-dlp --version || echo "yt-dlp installation failed"
    ignoreErrors: true
    
  03_install_ffmpeg:
    command: |
      # Install FFmpeg from RPM Fusion
      yum install -y https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm || true
      yum install -y ffmpeg ffmpeg-devel || echo "FFmpeg installation failed"
      
      # Verify FFmpeg installation
      ffmpeg -version || echo "FFmpeg not available"
    ignoreErrors: true
    
  04_setup_directories:
    command: |
      # Create necessary directories
      mkdir -p /tmp/downloads /var/log/savemedia
      chmod 777 /tmp/downloads
      chmod 755 /var/log/savemedia
      
      # Set ownership
      chown webapp:webapp /tmp/downloads /var/log/savemedia || true
    ignoreErrors: true
    
  05_php_extensions:
    command: |
      # Install additional PHP extensions if needed
      yum install -y php-curl php-json php-mbstring || true
    ignoreErrors: true
