# PHP Configuration - Fixed for Elastic Beanstalk
option_settings:
  # Valid EB PHP settings only
  aws:elasticbeanstalk:container:php:phpini:
    memory_limit: 512M
    max_execution_time: 300
    post_max_size: 100M
    
  # Environment settings
  aws:elasticbeanstalk:environment:
    EnvironmentType: SingleInstance
    
  # Instance configuration
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.medium
    DisableIMDSv1: true

# Custom PHP settings via files
files:
  "/etc/php.d/99-savemedia.ini":
    mode: "000644"
    owner: root
    group: root
    content: |
      ; SaveMedia Custom PHP Settings
      memory_limit = 512M
      max_execution_time = 300
      max_input_time = 300
      post_max_size = 100M
      upload_max_filesize = 100M
      max_file_uploads = 20
      allow_url_fopen = On
      enable_dl = Off
      expose_php = Off
      log_errors = On
      error_log = /var/log/php_errors.log
      
      ; Session settings
      session.gc_maxlifetime = 3600
      session.cookie_httponly = 1
      session.use_strict_mode = 1
      
      ; Security settings
      disable_functions = exec,passthru,shell_exec,system,proc_open,popen
      
container_commands:
  01_restart_php_fpm:
    command: "service php-fpm restart"
    ignoreErrors: true
